{% extends "layouts/base.html" %}
{% block title %}{{title}}{% endblock %}
{% block head %}
  {{ super() }}
{% endblock %}
{% block content %}
<div class="row text-center">
  <h1>{{title}}</h1>
  <ul id="listfan"></ul>
    <div id="DivForControl">

    </div>
    <div id="bajs">
      <button type="button" class="btn-danger btn-danger">bajsotto</button>
    </div>
    
    <br/>
    <br/>
    <div id="FormBajs"></div>

    <button type="button" class="btn btn-primary" onclick="clearSkit()">Clear</button>
    <button type="button" class="btn btn-danger">Send</button>

</div>

</div>
<script>  
  function clearSkit(){
    console.log("Will now clear");
    var data = sessionStorage.getItem("relays");
    //console.log("SHITTY DATA:\n"+data);
    data = JSON.parse(data);
    //console.log("SHITTiest DATA:\n"+JSON.stringify(data["data"]));
    var relays = data["data"];
    relays["relays"].forEach(relay => {
      document.getElementById("isOff"+relay["id"]).checked=true;
    })

    /*//FOllowing is just incase of future javascript effort.
    var divCont = document.getElementById("FormBajs");
    if(!divCont.hasChildNodes()){
      console.log("No children of div!");
      return;
    }
    //ELSE:
    var forms = divCont.children;
    forms.forEach(form =>{
      if(!form.hasChildNodes()) continue;
      //ELSE:

    });
    */
  }
  
  
  $.ajax({
    url:"/arduino_relay",
    type:'GET',
    dataType:'json',
    //headers:{"credentials":"BAJS"},
    //credentials:"BAJS",
    beforeSend: function(request) {
    request.setRequestHeader("x-api-key",1337);
    request.setRequestHeader("Credentials", "BAJS");
    },

    contentType: 'application/json; charset=utf-8',
    success: function (result) {
      sessionStorage.setItem("relays",JSON.stringify(result));
      console.log("RESULTATFAN: "+JSON.stringify(result));
      console.log("Ã„r detta data?: "+result["data"]);
      var data = result["data"]["relays"];
      //sessionStorage.setItem("relays",result["data"]);
      
      var li = document.getElementById("listfan");
      var DivForControl = document.getElementById("DivForControl");
      var FormBajs = document.getElementById("FormBajs");
      data.forEach(element => {
        var textNode = document.createTextNode(JSON.stringify(element));
        var node = document.createElement("LI");
        node.appendChild(textNode);
        li.appendChild(node);
        
        //TODO: WIll try to make child of label id "ON" or "OFF".
        var formDiv = document.createElement("div");
        formDiv.id="form_relay_"+element["id"];
        formDiv.classList.add("panel");
        formDiv.classList.add("panel-default");
        formDiv.classList.add("form-check");
        //formDiv.innerHTML("<h1>Relay: "+data["id"]+"</h1>");
        console.log("ID?: "+element["id"]);
        var innerText = document.createTextNode("Relay "+ element["id"]+": ");
        formDiv.appendChild(innerText);
        var lineBreak = document.createElement("br");
        formDiv.appendChild(lineBreak);

        var labelON = document.createElement("label");
        var radioON = document.createElement("input");
        labelON.classList.add("form-check-label");
        radioON.classList.add("form-check-input");

        radioON.type = "radio";
        radioON.name="yes_no_"+element["id"];
        radioON.id="isOn"+element["id"];
        radioON.value="isOn";
        if(element["relay_is_on"]) console.log("Helvetes skit");
        //radioON.checked = element["relay_is_on"];
        //radioON.checked =true;

        labelON.appendChild(radioON);
        labelON.innerHTML+="ON";
        formDiv.appendChild(labelON);

        var labelOFF = document.createElement("label");
        var radioOFF = document.createElement("input");
        labelOFF.classList.add("form-check-label");
        radioOFF.classList.add("form-check-input");
        radioOFF.name="yes_no_"+element["id"];
        radioOFF.type = "radio";
        radioOFF.id="isOff"+element["id"];
        radioOFF.value="isOff";
        labelOFF.appendChild(radioOFF);
        labelOFF.innerHTML+="OFF";
        formDiv.appendChild(labelOFF);
        
        FormBajs.appendChild(formDiv);
        document.getElementById("isOn"+element["id"]).checked=element["relay_is_on"];
        document.getElementById("isOff"+element["id"]).checked=!element["relay_is_on"];

      });
               
    },
    error: function (request,status,error) {
    console.log("request: "+request);  
    console.log("status: "+status);  
    console.log("ERROR: "+error);  
    }
  });

</script>
{% endblock %}
